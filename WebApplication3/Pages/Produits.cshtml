@page
@using Microsoft.EntityFrameworkCore
@model ProduitsModel
@{
    var searchTerm = HttpContext.Request.Query["search"].ToString();
    ViewData["Title"] = "Nos PC";
}


<div class="h-full bg-[#0f172a] text-slate-100  font-sans">
    <div class="">


<div class="h-full  bg-[#0f172a] text-slate-100 font-sans">
    <div class="w-full  ">

<div class="relative h-24 py-4 overflow-hidden  border border-white/5 bg-slate-950/80 mb-6 ">
    
    <div class="absolute inset-0 z-0 opacity-20 pointer-events-none overflow-hidden">
        <div class="flex  animate-marquee whitespace-nowrap ">
            @* On duplique la liste pour créer l'effet infini *@
            @foreach (var p in Model.Produits.Take(6)) {
                <img src="/Images/@p.Image" class="h-24 w-24 object-contain grayscale blur-[2px] hover:grayscale-0 transition-all" />
            }
            @foreach (var p in Model.Produits.Take(6)) {
                <img src="/Images/@p.Image" class="h-24 w-24 object-contain grayscale blur-[2px]" />
            }
        </div>
    </div>

    <div class="absolute inset-0 z-10 bg-gradient-to-r from-slate-950 via-slate-950/80 to-transparent"></div>

    <div class="relative z-20 flex flex-col md:flex-row md:items-center justify-between  ">
        <div class="space-y-1">
            <h1 class="text-3xl font-light tracking-tighter text-white">
                HARDWARE <span class="font-black text-blue-500">COLLECTION</span>
            </h1>
            <div class="flex items-center gap-3">
                <span class="h-px w-8 bg-blue-500/50"></span>
                <p class="text-[10px] uppercase tracking-[0.2em] text-slate-500 font-bold">Performance Lab</p>
            </div>
        </div>

        <div class="relative group">
            <div class="absolute inset-0 bg-blue-500/5 rounded-full blur-xl opacity-0 group-focus-within:opacity-100 transition-opacity"></div>
            <div class="relative flex items-center">
                <span class="material-symbols-outlined absolute left-4 text-slate-500 text-lg group-focus-within:text-blue-400 transition-colors">
                    search
                </span>
                <input type="text" 
                       id="searchInput"
                       placeholder="Search assets..." 
                       class="w-full md:w-64 bg-slate-900/40 border border-white/10 text-slate-300 pl-12 pr-4 py-2.5 rounded-full outline-none focus:w-full md:focus:w-80 focus:border-blue-500/30 transition-all duration-500 placeholder:text-slate-600 text-sm backdrop-blur-xl" />
                
                <div class="absolute right-2 px-2 py-0.5 bg-slate-800/80 rounded-full border border-white/5 shadow-sm">
                    <span class="text-[9px] font-black text-slate-400">
                        @(Model.Produits.Count())
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>



<style>
    /* Animation du défilement infini */
    @@keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }

    .animate-marquee {
        display: flex;
        width: max-content;
        animation: marquee 30s linear infinite;
    }

    /* Pause l'animation au survol si besoin */
    .animate-marquee:hover {
        animation-play-state: paused;
    }
</style>
<div class="h-px w-full bg-gradient-to-r from-transparent via-slate-800 to-transparent mb-10"></div>


        @if (Model.Produits.Any())
        {
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                @foreach (var p in Model.Produits)
                {
                    <div class="group relative bg-slate-800 rounded-xl border border-slate-700 overflow-hidden shadow-2xl hover:border-blue-500/50 transition-all duration-500 transform hover:-translate-y-1">

                        @{
                            string stockBadgeClass = p.Quantite == 0 ? "bg-red-600/80" : (p.Quantite < 5 ? "bg-orange-600/80" : "bg-green-600/80");
                            string stockText = p.Quantite == 0 ? "Rupture de stock" : (p.Quantite < 5 ? $"Plus que {p.Quantite} en stock !" : "En stock");
                        }
                    <div class="absolute top-4 right-4 z-10 @stockBadgeClass text-white px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-sm shadow-lg border border-white/20">
                        @stockText
                    </div>

                    <div class="relative h-48 sm:h-56 bg-slate-900 overflow-hidden">
                        <img src="~/Images/@p.Image"
                             alt="@p.Nom"
                             class="w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-700 ease-out">

                        <div class="absolute inset-0 bg-gradient-to-t from-slate-900/50 via-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    </div>

                    <div class="p-5 flex flex-col justify-between h-auto">

                        <div>
                            <h3 class="text-xl font-bold text-white mb-2 line-clamp-2 group-hover:text-blue-400 transition-colors duration-300">
                                @p.Nom
                            </h3>
                            <p class="text-slate-400 text-sm mb-4 line-clamp-3">
                                @p.Description
                            </p>
                        </div>

                        <div class="mt-4 border-t border-slate-700 pt-4">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                                    @p.Prix <span class="text-base text-slate-300">MAD</span>
                                </p>
                            </div>

                            <form method="post" asp-page-handler="AddToCart">
                                <input type="hidden" name="id" value="@p.Id" />
                                <button type="submit"
                                        @(p.Quantite == 0 ? "disabled" : "")
                                        class="w-full py-3 rounded-xl font-semibold transition-all duration-300 transform flex items-center justify-center gap-2
                                                    @(p.Quantite == 0
                                                                                            ? "bg-slate-700 text-slate-500 cursor-not-allowed"
                                                                                            : "bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white shadow-lg hover:shadow-blue-500/40 active:scale-[0.98]")">

                                        @if (p.Quantite == 0)
                                        {
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                            <span>Indisponible</span>
                                        }
                                        else
                                        {
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                            <span>Ajouter au panier</span>
                                        }
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else if (string.IsNullOrEmpty(searchTerm))
        {
            <div class="text-center py-20 bg-slate-900/50 rounded-xl border border-slate-800 border-dashed">
                <svg class="w-24 h-24 text-slate-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                </svg>
                <h3 class="text-2xl font-semibold text-slate-300 mb-2">Notre boutique est en cours de réapprovisionnement</h3>
                <p class="text-slate-500">Revenez bientôt pour découvrir nos nouveautés !</p>
            </div>
        }
        else
        {
            <div class="text-center py-20 bg-slate-900/50 rounded-xl border border-slate-800 border-dashed">
                <svg class="w-24 h-24 text-red-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2A9 9 0 111 11a9 9 0 0118 0z"></path>
                </svg>
                <h3 class="text-2xl font-semibold text-slate-300 mb-2">Aucun résultat trouvé pour "@searchTerm"</h3>
                <p class="text-slate-500">Veuillez essayer avec des mots-clés différents ou <a href="/Produits" class="text-blue-400 hover:text-blue-300 underline">revenir à la liste complète</a>.</p>
            </div>
        }
    </div>
</div>

<style>
    /* Pas besoin de toutes les animations custom si le layout est bien fait,
           Tailwind gère la plupart des transitions de base.
           Cependant, je garde les helpers pour line-clamp. */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Pour cacher la flèche sur les inputs type number */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
</style>

<script>
    const searchInput = document.getElementById('searchInput');
    const productCards = document.querySelectorAll('.grid > div'); // toutes les cartes PC

    searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase();

        productCards.forEach(card => {
            const name = card.querySelector('h3')?.textContent.toLowerCase() || '';
            const desc = card.querySelector('p')?.textContent.toLowerCase() || '';

            if (name.includes(query) || desc.includes(query)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>
